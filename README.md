# Сервис картинок

Это веб-приложение для загрузки, хранения и просмотра изображений.
Пользователи могут загружать изображения в популярных форматах (JPG, PNG, GIF),
а затем получать прямые ссылки на них для использования в соцсетях, блогах или
просто для обмена с друзьями.

## Основные функции

- **Загрузка изображений**: Пользователи могут загружать изображения через
  веб-интерфейс.
- **Галерея изображений**: Все загруженные изображения отображаются в галерее.
- **Просмотр и скачивание**: Пользователь может посмотреть и скачать
  изображение по прямой ссылке.

## Технологии

- **Python**: Основной язык программирования для бэкенда.
- **aiohttp**: Для обработки HTTP-запросов.
- **Pillow**: Библиотека для работы с изображениями.
- **Nginx**: Веб-сервер для раздачи статических файлов и проксирования
  запросов.
- **Docker**: Контейнеризация приложения.
- **Docker Compose**: Управление контейнерами и их взаимодействием.

## Установка и запуск

### Требования

- Установленные Docker и Docker Compose.

### Шаги для запуска

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/HapppyEnd/image_server.git
   cd image_server
   ```
2. Создайте файл ```.env``` в корне проекта и настройте переменные окружения:
    ```bash
    ALLOWED_EXTENSIONS=jpg,jpeg,png,gif
    APP_PORT = 8000
    BASE_URL=http://localhost
    MAX_FILE_SIZE=5242880
    ```
3. Соберите и запустите контейнеры с помощью Docker Compose:
    ```bash
    docker-compose up --build
    ```
4. Приложение будет доступно по адресу: http://localhost.

## Маршруты

### Основные маршруты

1. ```GET /```: Главная страница.

2. ```GET /images```: Просмотр всех загруженных изображений в галерее.

3. ```GET /images/{название_файла}```: Просмотр конкретного изображения.

4. ```POST /upload```: Эндпоинт для загрузки изображений.
   Ответ включает прямую ссылку на загруженное изображение.

## Логирование

Логи записываются в файл ```logs/app.log``` в формате:

```[Дата/время] Действие: сообщение```


## Резервное копирование базы данных PostgreSQL


Система предоставляет возможность создания резервных копий базы данных 
PostgreSQL с помощью встроенных инструментов СУБД.
Резервные копии создаются вручную.

### Требования
- Установленный Docker

- Запущенный контейнер с PostgreSQL


### Использование

 - Выполните следующую команду:

```bash

./backup.sh
```

### Формат файлов резервных копий
Файлы сохраняются в формате:

`backup_YYYY-ММ-DD_HHMMSS.sql`

### Восстановление из резервной копии
 Для восстановления базы данных выполните:

```bash

docker exec -i db psql -U postgres -d dbname < /backups/backup_2025-01-24_153000.sql
```

### Обработка ошибок
При возникновении ошибки:

- Скрипт завершается с ненулевым кодом возврата

- Частично созданные файлы удаляются

- Выводится сообщение об ошибке
## Тестирование

Приложение покрыто автоматическими тестами, которые проверяют работу основных
маршрутов и функциональности. Тесты написаны с использованием библиотеки
```pytest``` и ```pytest-asyncio``` для поддержки асинхронного кода.

### Запуск тестов

Запустите тесты с помощью команды:

   ```bash
    pytest
   ```